<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
  
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>MultiLink</title>

  
</head><body>
<h3>Additional documentation for <a href="/project/multilink">MultiLink</a></h3>

<h3>What's it for?</h3>

<em>MultiLink</em> is designed for multi-language sites. Please read
the <a href="/project/multilink">project page</a> for a general
description and example use cases. In short, it greatly simplifies
management of in-content links to other content (nodes), especially for
a site where not all content is available in all languages.
Additionally, <em>MultiLink</em> can automatically redirect users to
the correct language version of content when, for example, they follow
a link elsewhere which would take them to content in a language other
than their preferred language.
<h3>Path aliases</h3>

In many examples below, we refer to paths such as node/100 for
simplicity, but in practice urls generated will always use the <em>alias</em>
for that node, if defined.
<h3>Input Filter<br>
</h3>

<p><em>MultiLink</em> provides an input filter which allows you to
create a link by entering something like [100: more information] which
will be converted to:
<code><a href="http://example.com/node/100">more information</a>
</code>... or a similar link to node/101 if that is the French version
of node/100 and the user is browsing French content, or node/102 if
that is the Spanish version and the user is browsing Spanish content,
and so on. The <em>title</em> of the link (shown by the browser when
hovering over the link) will be taken from the actual title of the
target node.
</p>

<ul>

  <li>Instead of [100: more information] you can use use [100: $] and
the link generated will then show the <em>title</em> of the target
node.
  </li>
  <li>Advanced users change the format used to enter links in
MultiLink's configuration page, e.g. {100|Title} or ::100/Title:: would
be possible.
  </li>
</ul>

<h3>Support for other input filters</h3>

<em>MultiLink</em> supports integration with other modules and methods
of linking and including nodes in content. In effect it adds
"multi-language link" functionality to:
<ul>

  <li><a href="/project/pathfilter">PathFilter</a></li>
  <li><a href="/project/pathologic">Pathologic</a></li>
  <li><a href="/project/InsertNode">InsertNode</a></li>
  <li><a href="/project/linodef">Linodef</a></li>
  <li><a href="/project/link_node">link node</a></li>
  <li><a href="/project/markdown">Markdown</a></li>
  <li>simple HTML links (anchor tags)</li>
</ul>

<p>To use these features, you will need to enable them on the
configuration page for your filter format, and suitably configure
filter order so that MultiLink processing takes place before other
relevant filters such as InsertNode. In the cases of Markdown and HTML
links, use relative paths starting <strong>/node</strong> e.g.
/node/1234.</p>

<h3>MultiLink Redirect sub-module</h3>

<p>If installed, redirects requests to a node to the translated version
(if available) which can be useful for people who arrive at your site
via links on other sites (or even your own site, if not all links are
generated by MultiLink). For example, if a user goes to en/node/123 but
their preferred language (from browser or account settings) is French,
then they will be redirected to fr/node/124 where node/124 is the
French translation of node/123. In general, the user will end up at the
same page/url that they <em>would</em> have arrived at if they had
clicked a link generated by MultiLink.</p>

MultiLink Redirect provides much of the functionality of <a href="/project/globalredirect">Global Redirect</a> but using the same
rules and cached data used by the MultiLink Filter to determine which
page (node) should be served (the exact behaviour of Global Redirect on
a multi-language site is currently undefined - see [#201675].)<br>

If MultiLink SecurePages is also installed, then the user will be
redirect to an http or https version of the target page, as defined by
SecurePages configuration. Addresses an issue in the current version of
Secure Pages that prevents correct redirection in some situations - see
[#591116].<br>

<p>A permissions setting <em>bypass multilink redirect</em> allows the
redirect to be disabled on a role basis, intended for use by admins and
translation staff. A message is displayed showing the redirection that
would have been performed, so this feature is useful for testing that
the module is operating as anticipated.
</p>

<h4>Redirection of logged in users<br>
</h4>

In short, the system tries to redirect the user to the "best" url based
on the user's language preference, determined by the user account
setting if available, or otherwise by the user's browser configuration
for preferred language.&nbsp; The interface language (for menus, system
messages, etc) will be chosen to match the user's preferred language,
and the content (node) chosen will be in their preferred language if
available, otherwise some other "best fit" language.<br>

<h5>Examples</h5>

These examples assume a default configuration for <span style="font-style: italic;">MultiLink</span> - the default preference
order of various languages (from browser, user account, url, etc.) can
be changed via a <a href="#D6_branch_">configuration
setting.</a><br>

<br>

Let's say that the user's preferred language is Italian, and no path
aliases exist:<br>

<ul>

  <li>If the user requests it/node/123 and node 123 is in Italian, they
will not be redirected - the page will be served in the normal way.<br>
  </li>
  <li>If the user requests en/node/123 and node 123 is not in Italian
then they will be redirected to it/node/124, where node 124 is the
Italian translation of node 123. <br>
  </li>
  <li>If the user requests en/node/123 and no Italian translation of
node 123 exists, they will be redirected to it/node/125 where node 125
is a translation in some other suitable language (see <a href="#Behaviour">Behaviour</a> below).</li>
  <li>If the user requests en/node/123 and no suitable translation of
node 123 exists, they will be redirected to it/node/123.</li>
</ul>

The examples above refer to paths such as node/123 for simplicity, but
in practice the user will always be redirected to the <em>alias</em>
for a node, if defined.&nbsp;
<h4>Redirection of anonymous users<br>
</h4>

Behaviour depends on whether Drupal page caching is enabled or not. The
page cache is normally only active for anonymous users.<br>

<ul>

  <li>If page caching is switched off (or if for some other reason the
requested page is not cacheable) then anonymous users are redirected in
the same way as logged-in users. Language preference is, by default,
determined by user's browser configuration for preferred language.<br>
  </li>
  <li>If page caching is switched on (and the currenlty requested page
is cacheable) then anonymous users are <span style="font-weight: bold;">not</span>
redirected <span style="font-weight: bold;">unless</span> the included
    <span style="font-style: italic;">MultiLink Redirect Cached</span>
module is installed and enabled. With that module enabled, anonymous
users are redirected in the same way as logged-in users. Language
preference is, by default, determined by user's browser configuration
for preferred language.<br>
  </li>
</ul>

<h4>Combination with <a href="/project/globalredirect">Global Redirect</a></h4>

MultiLink Redirect has been tested with <a href="/project/globalredirect">Global Redirect</a> also installed and
the combination found to operate acceptably. However, you may need to
alter "weight" in the system table to obtain the desired results.
MultiLink Redirect will redirect requests to a single alias (the alias
returned by Drupal's <em>url()</em> function) and so this module alone
<em>may</em> be adequate to avoid the SEO issues which Global Redirect
is designed to address. However, Global Redirect provides other
functionality (e.g. dealing with paths to taxonomy terms) so you may
need both modules.<br>

<h3>MultiLink SecurePages sub-module</h3>

Currently for the D6 branch only. If installed, links generated by
MultiLink Filter will be http or https as defined by <a href="../../../../../../project/securepages">Secure Pages</a>, and
redirects will also use the correct protocol (http or https.)<br>

<h3>How does MultiLink generate urls?</h3>

The same process is used for generating urls whether for use as as
link-targets or redirection targets.<br>

<h4>Definitions:</h4>

First let's try to name some of the possible language choices that we
have to deal with:<br>

<ul>

  <li>User's <span style="font-style: italic;">preferred-language</span>.
This is the language they will always prefer for the site interface
(menus, blocks, etc.) and for content if available. <span style="font-style: italic;">preferred-language</span> is taken from
the user's account if available, otherwise from their browser
configuration.<br>
  </li>
  <li><span style="font-style: italic;">url-language</span><span style="font-style: italic;"></span> - The language specified by the
url currently requested. e.g. if they are currently at fr/node/123 then
    <span style="font-style: italic;">url-language</span> is French
(though node/123 is not necessarily in French).<br>
  </li>
  <li>The site <span style="font-style: italic;">default-language</span>.</li>
  <li><span style="font-style: italic;">node-language</span> - The
language of the node requested, e.g. for fr/node/123 where node 123 is
in English, then <span style="font-style: italic;">node-language</span>
is English. <br>
  </li>
  <li><span style="font-style: italic;">result-language</span> - The
language chosen by MultiLink as the "best fit" language for content to
be displayed (linked or redirected to). This depends on the
availability of node translations and order of language selection. - <a href="#Behaviour">see below</a>.</li>
</ul>

<span style="font-weight: bold;">New in version 2.5</span>, detection
of when the user switches to a different language, for example using
the standard Drupal language-switcher block. MultiLink subsequently
regards the newly selected language as the user's <span style="font-style: italic;">preferred-language</span> for the current
browser session.
<h4><a name="Behaviour"></a>Behaviour:</h4>

<ul>

  <li>MultiLink generates urls using <span style="font-style: italic;">preferred-language</span>
as the language prefix (path or sub-domain as defined by site
configuration) so that the user will always see the site interface in
their <span style="font-style: italic;">preferred-language</span>.</li>
  <li>MultiLink tries to choose the "best fit" for <span style="font-style: italic;">result-language</span> depending on
available translations. For sites where all content is always available
in all relevant languages, this is easy - <span style="font-style: italic;">result-language</span> will be <span style="font-style: italic;">preferred-language</span>. Otherwise, <span style="font-style: italic;">result-language</span> will be set by
choosing an available node translation, using order of preference (<a href="#Order_of_language_selection">see below</a>.)<span style="font-style: italic;"></span><br>
  </li>
  <li>MultiLink Redirect, if installed will redirect from <span style="font-style: italic;">url-language</span>/content-in-<span style="font-style: italic;">node-language</span> to <span style="font-style: italic;">preferred-language</span>/content-in-<span style="font-style: italic;">result-language</span>. It will also
redirect non-node paths, e.g. <span style="font-style: italic;">url-language</span>/user
will be redirected to <span style="font-style: italic;">preferred-language</span>/user.
  </li>
</ul>

<h3><a name="#Order_of_language_selection"></a>Order of language
selection</h3>

<p>The default order can be changed (since version 2.5) in
settings.php.&nbsp;
You can add a line in settings.php to control the order in which
possible languages are selected.</p>

<h5><a name="D6_branch_"></a>D6 branch<br>
</h5>

e.g:
<code>$conf['multilink_language_order'] = array(</code><code>'selected',
</code><code>'preferred', </code><code>'current', 'default');
<br>
</code>
<ul>

  <li><em>selected</em> is the language most recently actively selected
by the user (e.g. via a language switcher block.)</li>
  <li><em>preferred</em> is the user's "preferred" language, either
from browser settings or defined in the user account.</li>
  <li><em>current</em> is the current interface language.</li>
  <li><em>default</em> is the site default language.
  </li>
</ul>

<p>If <em>multilink_language_order</em> is not defined the default
order is: <em>selected, preferred, current, default</em>.&nbsp; Note
that the user's preferred-language referred to under <a href="Behaviour">Behaviour</a> can be over-ridden here - the <span style="font-style: italic;">first</span> of the languages defined by <em>multilink_language_order
</em>will be used <span style="font-style: italic;">preferred-language.</span></p>

<h5>D7 branch<br>
</h5>

As above except language names are in default order are now: <span style="font-style: italic;">selected, preferred, browser, current,
content, url</span> and <span style="font-style: italic;">default</span>.<br>

<ul>

  <li><em>preferred</em> is the user's "preferred" language from
account settings.</li>
  <li><span style="font-style: italic;">browser</span> is the user's
"preferred" language from browser settings.</li>
  <li><em>url</em> is the langusage specified by the requested url.</li>
  <li><span style="font-style: italic;">content</span> is the language
chosen by Drupal to display content - usually the same as <span style="font-style: italic;">current</span>.</li>
</ul>

Note: Drupal's choice for <span style="font-style: italic;">current</span>
and <span style="font-style: italic;">content</span> languages is
in-turn determined by language <span style="font-style: italic;">detection
and selection</span> settings at
admin/config/regional/language/configure.<br>

<h3>Performance and caching</h3>

<p>Standard Drupal page caching is supported for anonymous users.
[*more detail needed - redirection may prevent a cached page from being
served, and anonymous users may see a cached page containing links
which do not point to the same nodes as they would in the same page
non-cached.]</p>

<p>For logged-in users, or when page-caching is not enabled, there are
further caching mechanisms:</p>

<p>The module uses a smart caching scheme to avoid performance
degradation. For example, it caches links to translated versions of
node/100, but if node/100 or a translation of it is added, edited or
deleted then the relevant cache entries are cleared so that the
generated links will be updated.</p>

Optionally, and currently D6 only, you can enable additional caching by
Drupal which will improve performance considerably for non-cached
pages. As with page-caching, outdated links may be shown for 24 hours -
for example when a new translation is added it will be used as a link
or redirect target until the cache has expired. This is an advanced
option and to be effective requires the following:
<ul>

  <li>A <a href="http://drupalcode.org/viewvc/drupal/contributions/modules/language_sections/check_markup_language_patch_1.patch?revision=1.1.2.1&amp;content-type=text%2Fplain&amp;view=co">patch</a>
which makes Drupal 6 filter caching language-aware.<br>
  </li>
  <li>A suitably configured input format such that all other filters
are cacheable too (you can check with <a href="/project/filtercheck">Filter
Check</a>).
  </li>
</ul>

</body></html>